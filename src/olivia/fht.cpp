/*
 *  SPDX-License-Identifier: LGPL-2.1-or-later
 *
 *  TRX Brass LVGL GUI
 *
 *  Copyright (c) 2022-2024 Belousov Oleg aka R1CBU
 */

#include "fht.h"

void FHT(float *data) {
    float buf[64];

    buf[0] = data[0] + data[1];
    buf[2] = data[2] + data[3];
    buf[4] = data[4] + data[5];
    buf[6] = data[6] + data[7];
    buf[8] = data[8] + data[9];
    buf[10] = data[10] + data[11];
    buf[12] = data[12] + data[13];
    buf[14] = data[14] + data[15];
    buf[16] = data[16] + data[17];
    buf[18] = data[18] + data[19];
    buf[20] = data[20] + data[21];
    buf[22] = data[22] + data[23];
    buf[24] = data[24] + data[25];
    buf[26] = data[26] + data[27];
    buf[28] = data[28] + data[29];
    buf[30] = data[30] + data[31];
    buf[32] = data[32] + data[33];
    buf[34] = data[34] + data[35];
    buf[36] = data[36] + data[37];
    buf[38] = data[38] + data[39];
    buf[40] = data[40] + data[41];
    buf[42] = data[42] + data[43];
    buf[44] = data[44] + data[45];
    buf[46] = data[46] + data[47];
    buf[48] = data[48] + data[49];
    buf[50] = data[50] + data[51];
    buf[52] = data[52] + data[53];
    buf[54] = data[54] + data[55];
    buf[56] = data[56] + data[57];
    buf[58] = data[58] + data[59];
    buf[60] = data[60] + data[61];
    buf[62] = data[62] + data[63];
    buf[1] = data[0] - data[1];
    buf[3] = data[2] - data[3];
    buf[5] = data[4] - data[5];
    buf[7] = data[6] - data[7];
    buf[9] = data[8] - data[9];
    buf[11] = data[10] - data[11];
    buf[13] = data[12] - data[13];
    buf[15] = data[14] - data[15];
    buf[17] = data[16] - data[17];
    buf[19] = data[18] - data[19];
    buf[21] = data[20] - data[21];
    buf[23] = data[22] - data[23];
    buf[25] = data[24] - data[25];
    buf[27] = data[26] - data[27];
    buf[29] = data[28] - data[29];
    buf[31] = data[30] - data[31];
    buf[33] = data[32] - data[33];
    buf[35] = data[34] - data[35];
    buf[37] = data[36] - data[37];
    buf[39] = data[38] - data[39];
    buf[41] = data[40] - data[41];
    buf[43] = data[42] - data[43];
    buf[45] = data[44] - data[45];
    buf[47] = data[46] - data[47];
    buf[49] = data[48] - data[49];
    buf[51] = data[50] - data[51];
    buf[53] = data[52] - data[53];
    buf[55] = data[54] - data[55];
    buf[57] = data[56] - data[57];
    buf[59] = data[58] - data[59];
    buf[61] = data[60] - data[61];
    buf[63] = data[62] - data[63];

    data[0] = buf[0] + buf[2];
    data[1] = buf[1] + buf[3];
    data[4] = buf[4] + buf[6];
    data[5] = buf[5] + buf[7];
    data[8] = buf[8] + buf[10];
    data[9] = buf[9] + buf[11];
    data[12] = buf[12] + buf[14];
    data[13] = buf[13] + buf[15];
    data[16] = buf[16] + buf[18];
    data[17] = buf[17] + buf[19];
    data[20] = buf[20] + buf[22];
    data[21] = buf[21] + buf[23];
    data[24] = buf[24] + buf[26];
    data[25] = buf[25] + buf[27];
    data[28] = buf[28] + buf[30];
    data[29] = buf[29] + buf[31];
    data[32] = buf[32] + buf[34];
    data[33] = buf[33] + buf[35];
    data[36] = buf[36] + buf[38];
    data[37] = buf[37] + buf[39];
    data[40] = buf[40] + buf[42];
    data[41] = buf[41] + buf[43];
    data[44] = buf[44] + buf[46];
    data[45] = buf[45] + buf[47];
    data[48] = buf[48] + buf[50];
    data[49] = buf[49] + buf[51];
    data[52] = buf[52] + buf[54];
    data[53] = buf[53] + buf[55];
    data[56] = buf[56] + buf[58];
    data[57] = buf[57] + buf[59];
    data[60] = buf[60] + buf[62];
    data[61] = buf[61] + buf[63];
    data[2] = buf[0] - buf[2];
    data[3] = buf[1] - buf[3];
    data[6] = buf[4] - buf[6];
    data[7] = buf[5] - buf[7];
    data[10] = buf[8] - buf[10];
    data[11] = buf[9] - buf[11];
    data[14] = buf[12] - buf[14];
    data[15] = buf[13] - buf[15];
    data[18] = buf[16] - buf[18];
    data[19] = buf[17] - buf[19];
    data[22] = buf[20] - buf[22];
    data[23] = buf[21] - buf[23];
    data[26] = buf[24] - buf[26];
    data[27] = buf[25] - buf[27];
    data[30] = buf[28] - buf[30];
    data[31] = buf[29] - buf[31];
    data[34] = buf[32] - buf[34];
    data[35] = buf[33] - buf[35];
    data[38] = buf[36] - buf[38];
    data[39] = buf[37] - buf[39];
    data[42] = buf[40] - buf[42];
    data[43] = buf[41] - buf[43];
    data[46] = buf[44] - buf[46];
    data[47] = buf[45] - buf[47];
    data[50] = buf[48] - buf[50];
    data[51] = buf[49] - buf[51];
    data[54] = buf[52] - buf[54];
    data[55] = buf[53] - buf[55];
    data[58] = buf[56] - buf[58];
    data[59] = buf[57] - buf[59];
    data[62] = buf[60] - buf[62];
    data[63] = buf[61] - buf[63];

    buf[0] = data[0] + data[4];
    buf[1] = data[1] + data[5];
    buf[2] = data[2] + data[6];
    buf[3] = data[3] + data[7];
    buf[8] = data[8] + data[12];
    buf[9] = data[9] + data[13];
    buf[10] = data[10] + data[14];
    buf[11] = data[11] + data[15];
    buf[16] = data[16] + data[20];
    buf[17] = data[17] + data[21];
    buf[18] = data[18] + data[22];
    buf[19] = data[19] + data[23];
    buf[24] = data[24] + data[28];
    buf[25] = data[25] + data[29];
    buf[26] = data[26] + data[30];
    buf[27] = data[27] + data[31];
    buf[32] = data[32] + data[36];
    buf[33] = data[33] + data[37];
    buf[34] = data[34] + data[38];
    buf[35] = data[35] + data[39];
    buf[40] = data[40] + data[44];
    buf[41] = data[41] + data[45];
    buf[42] = data[42] + data[46];
    buf[43] = data[43] + data[47];
    buf[48] = data[48] + data[52];
    buf[49] = data[49] + data[53];
    buf[50] = data[50] + data[54];
    buf[51] = data[51] + data[55];
    buf[56] = data[56] + data[60];
    buf[57] = data[57] + data[61];
    buf[58] = data[58] + data[62];
    buf[59] = data[59] + data[63];
    buf[4] = data[0] - data[4];
    buf[5] = data[1] - data[5];
    buf[6] = data[2] - data[6];
    buf[7] = data[3] - data[7];
    buf[12] = data[8] - data[12];
    buf[13] = data[9] - data[13];
    buf[14] = data[10] - data[14];
    buf[15] = data[11] - data[15];
    buf[20] = data[16] - data[20];
    buf[21] = data[17] - data[21];
    buf[22] = data[18] - data[22];
    buf[23] = data[19] - data[23];
    buf[28] = data[24] - data[28];
    buf[29] = data[25] - data[29];
    buf[30] = data[26] - data[30];
    buf[31] = data[27] - data[31];
    buf[36] = data[32] - data[36];
    buf[37] = data[33] - data[37];
    buf[38] = data[34] - data[38];
    buf[39] = data[35] - data[39];
    buf[44] = data[40] - data[44];
    buf[45] = data[41] - data[45];
    buf[46] = data[42] - data[46];
    buf[47] = data[43] - data[47];
    buf[52] = data[48] - data[52];
    buf[53] = data[49] - data[53];
    buf[54] = data[50] - data[54];
    buf[55] = data[51] - data[55];
    buf[60] = data[56] - data[60];
    buf[61] = data[57] - data[61];
    buf[62] = data[58] - data[62];
    buf[63] = data[59] - data[63];

    data[0] = buf[0] + buf[8];
    data[1] = buf[1] + buf[9];
    data[2] = buf[2] + buf[10];
    data[3] = buf[3] + buf[11];
    data[4] = buf[4] + buf[12];
    data[5] = buf[5] + buf[13];
    data[6] = buf[6] + buf[14];
    data[7] = buf[7] + buf[15];
    data[16] = buf[16] + buf[24];
    data[17] = buf[17] + buf[25];
    data[18] = buf[18] + buf[26];
    data[19] = buf[19] + buf[27];
    data[20] = buf[20] + buf[28];
    data[21] = buf[21] + buf[29];
    data[22] = buf[22] + buf[30];
    data[23] = buf[23] + buf[31];
    data[32] = buf[32] + buf[40];
    data[33] = buf[33] + buf[41];
    data[34] = buf[34] + buf[42];
    data[35] = buf[35] + buf[43];
    data[36] = buf[36] + buf[44];
    data[37] = buf[37] + buf[45];
    data[38] = buf[38] + buf[46];
    data[39] = buf[39] + buf[47];
    data[48] = buf[48] + buf[56];
    data[49] = buf[49] + buf[57];
    data[50] = buf[50] + buf[58];
    data[51] = buf[51] + buf[59];
    data[52] = buf[52] + buf[60];
    data[53] = buf[53] + buf[61];
    data[54] = buf[54] + buf[62];
    data[55] = buf[55] + buf[63];
    data[8] = buf[0] - buf[8];
    data[9] = buf[1] - buf[9];
    data[10] = buf[2] - buf[10];
    data[11] = buf[3] - buf[11];
    data[12] = buf[4] - buf[12];
    data[13] = buf[5] - buf[13];
    data[14] = buf[6] - buf[14];
    data[15] = buf[7] - buf[15];
    data[24] = buf[16] - buf[24];
    data[25] = buf[17] - buf[25];
    data[26] = buf[18] - buf[26];
    data[27] = buf[19] - buf[27];
    data[28] = buf[20] - buf[28];
    data[29] = buf[21] - buf[29];
    data[30] = buf[22] - buf[30];
    data[31] = buf[23] - buf[31];
    data[40] = buf[32] - buf[40];
    data[41] = buf[33] - buf[41];
    data[42] = buf[34] - buf[42];
    data[43] = buf[35] - buf[43];
    data[44] = buf[36] - buf[44];
    data[45] = buf[37] - buf[45];
    data[46] = buf[38] - buf[46];
    data[47] = buf[39] - buf[47];
    data[56] = buf[48] - buf[56];
    data[57] = buf[49] - buf[57];
    data[58] = buf[50] - buf[58];
    data[59] = buf[51] - buf[59];
    data[60] = buf[52] - buf[60];
    data[61] = buf[53] - buf[61];
    data[62] = buf[54] - buf[62];
    data[63] = buf[55] - buf[63];

    buf[0] = data[0] + data[16];
    buf[1] = data[1] + data[17];
    buf[2] = data[2] + data[18];
    buf[3] = data[3] + data[19];
    buf[4] = data[4] + data[20];
    buf[5] = data[5] + data[21];
    buf[6] = data[6] + data[22];
    buf[7] = data[7] + data[23];
    buf[8] = data[8] + data[24];
    buf[9] = data[9] + data[25];
    buf[10] = data[10] + data[26];
    buf[11] = data[11] + data[27];
    buf[12] = data[12] + data[28];
    buf[13] = data[13] + data[29];
    buf[14] = data[14] + data[30];
    buf[15] = data[15] + data[31];
    buf[32] = data[32] + data[48];
    buf[33] = data[33] + data[49];
    buf[34] = data[34] + data[50];
    buf[35] = data[35] + data[51];
    buf[36] = data[36] + data[52];
    buf[37] = data[37] + data[53];
    buf[38] = data[38] + data[54];
    buf[39] = data[39] + data[55];
    buf[40] = data[40] + data[56];
    buf[41] = data[41] + data[57];
    buf[42] = data[42] + data[58];
    buf[43] = data[43] + data[59];
    buf[44] = data[44] + data[60];
    buf[45] = data[45] + data[61];
    buf[46] = data[46] + data[62];
    buf[47] = data[47] + data[63];
    buf[16] = data[0] - data[16];
    buf[17] = data[1] - data[17];
    buf[18] = data[2] - data[18];
    buf[19] = data[3] - data[19];
    buf[20] = data[4] - data[20];
    buf[21] = data[5] - data[21];
    buf[22] = data[6] - data[22];
    buf[23] = data[7] - data[23];
    buf[24] = data[8] - data[24];
    buf[25] = data[9] - data[25];
    buf[26] = data[10] - data[26];
    buf[27] = data[11] - data[27];
    buf[28] = data[12] - data[28];
    buf[29] = data[13] - data[29];
    buf[30] = data[14] - data[30];
    buf[31] = data[15] - data[31];
    buf[48] = data[32] - data[48];
    buf[49] = data[33] - data[49];
    buf[50] = data[34] - data[50];
    buf[51] = data[35] - data[51];
    buf[52] = data[36] - data[52];
    buf[53] = data[37] - data[53];
    buf[54] = data[38] - data[54];
    buf[55] = data[39] - data[55];
    buf[56] = data[40] - data[56];
    buf[57] = data[41] - data[57];
    buf[58] = data[42] - data[58];
    buf[59] = data[43] - data[59];
    buf[60] = data[44] - data[60];
    buf[61] = data[45] - data[61];
    buf[62] = data[46] - data[62];
    buf[63] = data[47] - data[63];

    data[0] = buf[0] + buf[32];
    data[1] = buf[1] + buf[33];
    data[2] = buf[2] + buf[34];
    data[3] = buf[3] + buf[35];
    data[4] = buf[4] + buf[36];
    data[5] = buf[5] + buf[37];
    data[6] = buf[6] + buf[38];
    data[7] = buf[7] + buf[39];
    data[8] = buf[8] + buf[40];
    data[9] = buf[9] + buf[41];
    data[10] = buf[10] + buf[42];
    data[11] = buf[11] + buf[43];
    data[12] = buf[12] + buf[44];
    data[13] = buf[13] + buf[45];
    data[14] = buf[14] + buf[46];
    data[15] = buf[15] + buf[47];
    data[16] = buf[16] + buf[48];
    data[17] = buf[17] + buf[49];
    data[18] = buf[18] + buf[50];
    data[19] = buf[19] + buf[51];
    data[20] = buf[20] + buf[52];
    data[21] = buf[21] + buf[53];
    data[22] = buf[22] + buf[54];
    data[23] = buf[23] + buf[55];
    data[24] = buf[24] + buf[56];
    data[25] = buf[25] + buf[57];
    data[26] = buf[26] + buf[58];
    data[27] = buf[27] + buf[59];
    data[28] = buf[28] + buf[60];
    data[29] = buf[29] + buf[61];
    data[30] = buf[30] + buf[62];
    data[31] = buf[31] + buf[63];
    data[32] = buf[0] - buf[32];
    data[33] = buf[1] - buf[33];
    data[34] = buf[2] - buf[34];
    data[35] = buf[3] - buf[35];
    data[36] = buf[4] - buf[36];
    data[37] = buf[5] - buf[37];
    data[38] = buf[6] - buf[38];
    data[39] = buf[7] - buf[39];
    data[40] = buf[8] - buf[40];
    data[41] = buf[9] - buf[41];
    data[42] = buf[10] - buf[42];
    data[43] = buf[11] - buf[43];
    data[44] = buf[12] - buf[44];
    data[45] = buf[13] - buf[45];
    data[46] = buf[14] - buf[46];
    data[47] = buf[15] - buf[47];
    data[48] = buf[16] - buf[48];
    data[49] = buf[17] - buf[49];
    data[50] = buf[18] - buf[50];
    data[51] = buf[19] - buf[51];
    data[52] = buf[20] - buf[52];
    data[53] = buf[21] - buf[53];
    data[54] = buf[22] - buf[54];
    data[55] = buf[23] - buf[55];
    data[56] = buf[24] - buf[56];
    data[57] = buf[25] - buf[57];
    data[58] = buf[26] - buf[58];
    data[59] = buf[27] - buf[59];
    data[60] = buf[28] - buf[60];
    data[61] = buf[29] - buf[61];
    data[62] = buf[30] - buf[62];
    data[63] = buf[31] - buf[63];

}

// Inverse Fast Hadamard Transform

void IFHT_8(int8_t *data) {
    int8_t buf[64];

    buf[0] = data[0] - data[32];
    buf[1] = data[1] - data[33];
    buf[2] = data[2] - data[34];
    buf[3] = data[3] - data[35];
    buf[4] = data[4] - data[36];
    buf[5] = data[5] - data[37];
    buf[6] = data[6] - data[38];
    buf[7] = data[7] - data[39];
    buf[8] = data[8] - data[40];
    buf[9] = data[9] - data[41];
    buf[10] = data[10] - data[42];
    buf[11] = data[11] - data[43];
    buf[12] = data[12] - data[44];
    buf[13] = data[13] - data[45];
    buf[14] = data[14] - data[46];
    buf[15] = data[15] - data[47];
    buf[16] = data[16] - data[48];
    buf[17] = data[17] - data[49];
    buf[18] = data[18] - data[50];
    buf[19] = data[19] - data[51];
    buf[20] = data[20] - data[52];
    buf[21] = data[21] - data[53];
    buf[22] = data[22] - data[54];
    buf[23] = data[23] - data[55];
    buf[24] = data[24] - data[56];
    buf[25] = data[25] - data[57];
    buf[26] = data[26] - data[58];
    buf[27] = data[27] - data[59];
    buf[28] = data[28] - data[60];
    buf[29] = data[29] - data[61];
    buf[30] = data[30] - data[62];
    buf[31] = data[31] - data[63];
    buf[32] = data[0] + data[32];
    buf[33] = data[1] + data[33];
    buf[34] = data[2] + data[34];
    buf[35] = data[3] + data[35];
    buf[36] = data[4] + data[36];
    buf[37] = data[5] + data[37];
    buf[38] = data[6] + data[38];
    buf[39] = data[7] + data[39];
    buf[40] = data[8] + data[40];
    buf[41] = data[9] + data[41];
    buf[42] = data[10] + data[42];
    buf[43] = data[11] + data[43];
    buf[44] = data[12] + data[44];
    buf[45] = data[13] + data[45];
    buf[46] = data[14] + data[46];
    buf[47] = data[15] + data[47];
    buf[48] = data[16] + data[48];
    buf[49] = data[17] + data[49];
    buf[50] = data[18] + data[50];
    buf[51] = data[19] + data[51];
    buf[52] = data[20] + data[52];
    buf[53] = data[21] + data[53];
    buf[54] = data[22] + data[54];
    buf[55] = data[23] + data[55];
    buf[56] = data[24] + data[56];
    buf[57] = data[25] + data[57];
    buf[58] = data[26] + data[58];
    buf[59] = data[27] + data[59];
    buf[60] = data[28] + data[60];
    buf[61] = data[29] + data[61];
    buf[62] = data[30] + data[62];
    buf[63] = data[31] + data[63];

    data[0] = buf[0] - buf[16];
    data[1] = buf[1] - buf[17];
    data[2] = buf[2] - buf[18];
    data[3] = buf[3] - buf[19];
    data[4] = buf[4] - buf[20];
    data[5] = buf[5] - buf[21];
    data[6] = buf[6] - buf[22];
    data[7] = buf[7] - buf[23];
    data[8] = buf[8] - buf[24];
    data[9] = buf[9] - buf[25];
    data[10] = buf[10] - buf[26];
    data[11] = buf[11] - buf[27];
    data[12] = buf[12] - buf[28];
    data[13] = buf[13] - buf[29];
    data[14] = buf[14] - buf[30];
    data[15] = buf[15] - buf[31];
    data[32] = buf[32] - buf[48];
    data[33] = buf[33] - buf[49];
    data[34] = buf[34] - buf[50];
    data[35] = buf[35] - buf[51];
    data[36] = buf[36] - buf[52];
    data[37] = buf[37] - buf[53];
    data[38] = buf[38] - buf[54];
    data[39] = buf[39] - buf[55];
    data[40] = buf[40] - buf[56];
    data[41] = buf[41] - buf[57];
    data[42] = buf[42] - buf[58];
    data[43] = buf[43] - buf[59];
    data[44] = buf[44] - buf[60];
    data[45] = buf[45] - buf[61];
    data[46] = buf[46] - buf[62];
    data[47] = buf[47] - buf[63];
    data[16] = buf[0] + buf[16];
    data[17] = buf[1] + buf[17];
    data[18] = buf[2] + buf[18];
    data[19] = buf[3] + buf[19];
    data[20] = buf[4] + buf[20];
    data[21] = buf[5] + buf[21];
    data[22] = buf[6] + buf[22];
    data[23] = buf[7] + buf[23];
    data[24] = buf[8] + buf[24];
    data[25] = buf[9] + buf[25];
    data[26] = buf[10] + buf[26];
    data[27] = buf[11] + buf[27];
    data[28] = buf[12] + buf[28];
    data[29] = buf[13] + buf[29];
    data[30] = buf[14] + buf[30];
    data[31] = buf[15] + buf[31];
    data[48] = buf[32] + buf[48];
    data[49] = buf[33] + buf[49];
    data[50] = buf[34] + buf[50];
    data[51] = buf[35] + buf[51];
    data[52] = buf[36] + buf[52];
    data[53] = buf[37] + buf[53];
    data[54] = buf[38] + buf[54];
    data[55] = buf[39] + buf[55];
    data[56] = buf[40] + buf[56];
    data[57] = buf[41] + buf[57];
    data[58] = buf[42] + buf[58];
    data[59] = buf[43] + buf[59];
    data[60] = buf[44] + buf[60];
    data[61] = buf[45] + buf[61];
    data[62] = buf[46] + buf[62];
    data[63] = buf[47] + buf[63];

    buf[0] = data[0] - data[8];
    buf[1] = data[1] - data[9];
    buf[2] = data[2] - data[10];
    buf[3] = data[3] - data[11];
    buf[4] = data[4] - data[12];
    buf[5] = data[5] - data[13];
    buf[6] = data[6] - data[14];
    buf[7] = data[7] - data[15];
    buf[16] = data[16] - data[24];
    buf[17] = data[17] - data[25];
    buf[18] = data[18] - data[26];
    buf[19] = data[19] - data[27];
    buf[20] = data[20] - data[28];
    buf[21] = data[21] - data[29];
    buf[22] = data[22] - data[30];
    buf[23] = data[23] - data[31];
    buf[32] = data[32] - data[40];
    buf[33] = data[33] - data[41];
    buf[34] = data[34] - data[42];
    buf[35] = data[35] - data[43];
    buf[36] = data[36] - data[44];
    buf[37] = data[37] - data[45];
    buf[38] = data[38] - data[46];
    buf[39] = data[39] - data[47];
    buf[48] = data[48] - data[56];
    buf[49] = data[49] - data[57];
    buf[50] = data[50] - data[58];
    buf[51] = data[51] - data[59];
    buf[52] = data[52] - data[60];
    buf[53] = data[53] - data[61];
    buf[54] = data[54] - data[62];
    buf[55] = data[55] - data[63];
    buf[8] = data[0] + data[8];
    buf[9] = data[1] + data[9];
    buf[10] = data[2] + data[10];
    buf[11] = data[3] + data[11];
    buf[12] = data[4] + data[12];
    buf[13] = data[5] + data[13];
    buf[14] = data[6] + data[14];
    buf[15] = data[7] + data[15];
    buf[24] = data[16] + data[24];
    buf[25] = data[17] + data[25];
    buf[26] = data[18] + data[26];
    buf[27] = data[19] + data[27];
    buf[28] = data[20] + data[28];
    buf[29] = data[21] + data[29];
    buf[30] = data[22] + data[30];
    buf[31] = data[23] + data[31];
    buf[40] = data[32] + data[40];
    buf[41] = data[33] + data[41];
    buf[42] = data[34] + data[42];
    buf[43] = data[35] + data[43];
    buf[44] = data[36] + data[44];
    buf[45] = data[37] + data[45];
    buf[46] = data[38] + data[46];
    buf[47] = data[39] + data[47];
    buf[56] = data[48] + data[56];
    buf[57] = data[49] + data[57];
    buf[58] = data[50] + data[58];
    buf[59] = data[51] + data[59];
    buf[60] = data[52] + data[60];
    buf[61] = data[53] + data[61];
    buf[62] = data[54] + data[62];
    buf[63] = data[55] + data[63];

    data[0] = buf[0] - buf[4];
    data[1] = buf[1] - buf[5];
    data[2] = buf[2] - buf[6];
    data[3] = buf[3] - buf[7];
    data[8] = buf[8] - buf[12];
    data[9] = buf[9] - buf[13];
    data[10] = buf[10] - buf[14];
    data[11] = buf[11] - buf[15];
    data[16] = buf[16] - buf[20];
    data[17] = buf[17] - buf[21];
    data[18] = buf[18] - buf[22];
    data[19] = buf[19] - buf[23];
    data[24] = buf[24] - buf[28];
    data[25] = buf[25] - buf[29];
    data[26] = buf[26] - buf[30];
    data[27] = buf[27] - buf[31];
    data[32] = buf[32] - buf[36];
    data[33] = buf[33] - buf[37];
    data[34] = buf[34] - buf[38];
    data[35] = buf[35] - buf[39];
    data[40] = buf[40] - buf[44];
    data[41] = buf[41] - buf[45];
    data[42] = buf[42] - buf[46];
    data[43] = buf[43] - buf[47];
    data[48] = buf[48] - buf[52];
    data[49] = buf[49] - buf[53];
    data[50] = buf[50] - buf[54];
    data[51] = buf[51] - buf[55];
    data[56] = buf[56] - buf[60];
    data[57] = buf[57] - buf[61];
    data[58] = buf[58] - buf[62];
    data[59] = buf[59] - buf[63];
    data[4] = buf[0] + buf[4];
    data[5] = buf[1] + buf[5];
    data[6] = buf[2] + buf[6];
    data[7] = buf[3] + buf[7];
    data[12] = buf[8] + buf[12];
    data[13] = buf[9] + buf[13];
    data[14] = buf[10] + buf[14];
    data[15] = buf[11] + buf[15];
    data[20] = buf[16] + buf[20];
    data[21] = buf[17] + buf[21];
    data[22] = buf[18] + buf[22];
    data[23] = buf[19] + buf[23];
    data[28] = buf[24] + buf[28];
    data[29] = buf[25] + buf[29];
    data[30] = buf[26] + buf[30];
    data[31] = buf[27] + buf[31];
    data[36] = buf[32] + buf[36];
    data[37] = buf[33] + buf[37];
    data[38] = buf[34] + buf[38];
    data[39] = buf[35] + buf[39];
    data[44] = buf[40] + buf[44];
    data[45] = buf[41] + buf[45];
    data[46] = buf[42] + buf[46];
    data[47] = buf[43] + buf[47];
    data[52] = buf[48] + buf[52];
    data[53] = buf[49] + buf[53];
    data[54] = buf[50] + buf[54];
    data[55] = buf[51] + buf[55];
    data[60] = buf[56] + buf[60];
    data[61] = buf[57] + buf[61];
    data[62] = buf[58] + buf[62];
    data[63] = buf[59] + buf[63];

    buf[0] = data[0] - data[2];
    buf[1] = data[1] - data[3];
    buf[4] = data[4] - data[6];
    buf[5] = data[5] - data[7];
    buf[8] = data[8] - data[10];
    buf[9] = data[9] - data[11];
    buf[12] = data[12] - data[14];
    buf[13] = data[13] - data[15];
    buf[16] = data[16] - data[18];
    buf[17] = data[17] - data[19];
    buf[20] = data[20] - data[22];
    buf[21] = data[21] - data[23];
    buf[24] = data[24] - data[26];
    buf[25] = data[25] - data[27];
    buf[28] = data[28] - data[30];
    buf[29] = data[29] - data[31];
    buf[32] = data[32] - data[34];
    buf[33] = data[33] - data[35];
    buf[36] = data[36] - data[38];
    buf[37] = data[37] - data[39];
    buf[40] = data[40] - data[42];
    buf[41] = data[41] - data[43];
    buf[44] = data[44] - data[46];
    buf[45] = data[45] - data[47];
    buf[48] = data[48] - data[50];
    buf[49] = data[49] - data[51];
    buf[52] = data[52] - data[54];
    buf[53] = data[53] - data[55];
    buf[56] = data[56] - data[58];
    buf[57] = data[57] - data[59];
    buf[60] = data[60] - data[62];
    buf[61] = data[61] - data[63];
    buf[2] = data[0] + data[2];
    buf[3] = data[1] + data[3];
    buf[6] = data[4] + data[6];
    buf[7] = data[5] + data[7];
    buf[10] = data[8] + data[10];
    buf[11] = data[9] + data[11];
    buf[14] = data[12] + data[14];
    buf[15] = data[13] + data[15];
    buf[18] = data[16] + data[18];
    buf[19] = data[17] + data[19];
    buf[22] = data[20] + data[22];
    buf[23] = data[21] + data[23];
    buf[26] = data[24] + data[26];
    buf[27] = data[25] + data[27];
    buf[30] = data[28] + data[30];
    buf[31] = data[29] + data[31];
    buf[34] = data[32] + data[34];
    buf[35] = data[33] + data[35];
    buf[38] = data[36] + data[38];
    buf[39] = data[37] + data[39];
    buf[42] = data[40] + data[42];
    buf[43] = data[41] + data[43];
    buf[46] = data[44] + data[46];
    buf[47] = data[45] + data[47];
    buf[50] = data[48] + data[50];
    buf[51] = data[49] + data[51];
    buf[54] = data[52] + data[54];
    buf[55] = data[53] + data[55];
    buf[58] = data[56] + data[58];
    buf[59] = data[57] + data[59];
    buf[62] = data[60] + data[62];
    buf[63] = data[61] + data[63];

    data[0] = buf[0] - buf[1];
    data[2] = buf[2] - buf[3];
    data[4] = buf[4] - buf[5];
    data[6] = buf[6] - buf[7];
    data[8] = buf[8] - buf[9];
    data[10] = buf[10] - buf[11];
    data[12] = buf[12] - buf[13];
    data[14] = buf[14] - buf[15];
    data[16] = buf[16] - buf[17];
    data[18] = buf[18] - buf[19];
    data[20] = buf[20] - buf[21];
    data[22] = buf[22] - buf[23];
    data[24] = buf[24] - buf[25];
    data[26] = buf[26] - buf[27];
    data[28] = buf[28] - buf[29];
    data[30] = buf[30] - buf[31];
    data[32] = buf[32] - buf[33];
    data[34] = buf[34] - buf[35];
    data[36] = buf[36] - buf[37];
    data[38] = buf[38] - buf[39];
    data[40] = buf[40] - buf[41];
    data[42] = buf[42] - buf[43];
    data[44] = buf[44] - buf[45];
    data[46] = buf[46] - buf[47];
    data[48] = buf[48] - buf[49];
    data[50] = buf[50] - buf[51];
    data[52] = buf[52] - buf[53];
    data[54] = buf[54] - buf[55];
    data[56] = buf[56] - buf[57];
    data[58] = buf[58] - buf[59];
    data[60] = buf[60] - buf[61];
    data[62] = buf[62] - buf[63];
    data[1] = buf[0] + buf[1];
    data[3] = buf[2] + buf[3];
    data[5] = buf[4] + buf[5];
    data[7] = buf[6] + buf[7];
    data[9] = buf[8] + buf[9];
    data[11] = buf[10] + buf[11];
    data[13] = buf[12] + buf[13];
    data[15] = buf[14] + buf[15];
    data[17] = buf[16] + buf[17];
    data[19] = buf[18] + buf[19];
    data[21] = buf[20] + buf[21];
    data[23] = buf[22] + buf[23];
    data[25] = buf[24] + buf[25];
    data[27] = buf[26] + buf[27];
    data[29] = buf[28] + buf[29];
    data[31] = buf[30] + buf[31];
    data[33] = buf[32] + buf[33];
    data[35] = buf[34] + buf[35];
    data[37] = buf[36] + buf[37];
    data[39] = buf[38] + buf[39];
    data[41] = buf[40] + buf[41];
    data[43] = buf[42] + buf[43];
    data[45] = buf[44] + buf[45];
    data[47] = buf[46] + buf[47];
    data[49] = buf[48] + buf[49];
    data[51] = buf[50] + buf[51];
    data[53] = buf[52] + buf[53];
    data[55] = buf[54] + buf[55];
    data[57] = buf[56] + buf[57];
    data[59] = buf[58] + buf[59];
    data[61] = buf[60] + buf[61];
    data[63] = buf[62] + buf[63];
}

void IFHT_float(float *data) {
    float buf[64];

    buf[0] = data[0] - data[32];
    buf[1] = data[1] - data[33];
    buf[2] = data[2] - data[34];
    buf[3] = data[3] - data[35];
    buf[4] = data[4] - data[36];
    buf[5] = data[5] - data[37];
    buf[6] = data[6] - data[38];
    buf[7] = data[7] - data[39];
    buf[8] = data[8] - data[40];
    buf[9] = data[9] - data[41];
    buf[10] = data[10] - data[42];
    buf[11] = data[11] - data[43];
    buf[12] = data[12] - data[44];
    buf[13] = data[13] - data[45];
    buf[14] = data[14] - data[46];
    buf[15] = data[15] - data[47];
    buf[16] = data[16] - data[48];
    buf[17] = data[17] - data[49];
    buf[18] = data[18] - data[50];
    buf[19] = data[19] - data[51];
    buf[20] = data[20] - data[52];
    buf[21] = data[21] - data[53];
    buf[22] = data[22] - data[54];
    buf[23] = data[23] - data[55];
    buf[24] = data[24] - data[56];
    buf[25] = data[25] - data[57];
    buf[26] = data[26] - data[58];
    buf[27] = data[27] - data[59];
    buf[28] = data[28] - data[60];
    buf[29] = data[29] - data[61];
    buf[30] = data[30] - data[62];
    buf[31] = data[31] - data[63];
    buf[32] = data[0] + data[32];
    buf[33] = data[1] + data[33];
    buf[34] = data[2] + data[34];
    buf[35] = data[3] + data[35];
    buf[36] = data[4] + data[36];
    buf[37] = data[5] + data[37];
    buf[38] = data[6] + data[38];
    buf[39] = data[7] + data[39];
    buf[40] = data[8] + data[40];
    buf[41] = data[9] + data[41];
    buf[42] = data[10] + data[42];
    buf[43] = data[11] + data[43];
    buf[44] = data[12] + data[44];
    buf[45] = data[13] + data[45];
    buf[46] = data[14] + data[46];
    buf[47] = data[15] + data[47];
    buf[48] = data[16] + data[48];
    buf[49] = data[17] + data[49];
    buf[50] = data[18] + data[50];
    buf[51] = data[19] + data[51];
    buf[52] = data[20] + data[52];
    buf[53] = data[21] + data[53];
    buf[54] = data[22] + data[54];
    buf[55] = data[23] + data[55];
    buf[56] = data[24] + data[56];
    buf[57] = data[25] + data[57];
    buf[58] = data[26] + data[58];
    buf[59] = data[27] + data[59];
    buf[60] = data[28] + data[60];
    buf[61] = data[29] + data[61];
    buf[62] = data[30] + data[62];
    buf[63] = data[31] + data[63];

    data[0] = buf[0] - buf[16];
    data[1] = buf[1] - buf[17];
    data[2] = buf[2] - buf[18];
    data[3] = buf[3] - buf[19];
    data[4] = buf[4] - buf[20];
    data[5] = buf[5] - buf[21];
    data[6] = buf[6] - buf[22];
    data[7] = buf[7] - buf[23];
    data[8] = buf[8] - buf[24];
    data[9] = buf[9] - buf[25];
    data[10] = buf[10] - buf[26];
    data[11] = buf[11] - buf[27];
    data[12] = buf[12] - buf[28];
    data[13] = buf[13] - buf[29];
    data[14] = buf[14] - buf[30];
    data[15] = buf[15] - buf[31];
    data[32] = buf[32] - buf[48];
    data[33] = buf[33] - buf[49];
    data[34] = buf[34] - buf[50];
    data[35] = buf[35] - buf[51];
    data[36] = buf[36] - buf[52];
    data[37] = buf[37] - buf[53];
    data[38] = buf[38] - buf[54];
    data[39] = buf[39] - buf[55];
    data[40] = buf[40] - buf[56];
    data[41] = buf[41] - buf[57];
    data[42] = buf[42] - buf[58];
    data[43] = buf[43] - buf[59];
    data[44] = buf[44] - buf[60];
    data[45] = buf[45] - buf[61];
    data[46] = buf[46] - buf[62];
    data[47] = buf[47] - buf[63];
    data[16] = buf[0] + buf[16];
    data[17] = buf[1] + buf[17];
    data[18] = buf[2] + buf[18];
    data[19] = buf[3] + buf[19];
    data[20] = buf[4] + buf[20];
    data[21] = buf[5] + buf[21];
    data[22] = buf[6] + buf[22];
    data[23] = buf[7] + buf[23];
    data[24] = buf[8] + buf[24];
    data[25] = buf[9] + buf[25];
    data[26] = buf[10] + buf[26];
    data[27] = buf[11] + buf[27];
    data[28] = buf[12] + buf[28];
    data[29] = buf[13] + buf[29];
    data[30] = buf[14] + buf[30];
    data[31] = buf[15] + buf[31];
    data[48] = buf[32] + buf[48];
    data[49] = buf[33] + buf[49];
    data[50] = buf[34] + buf[50];
    data[51] = buf[35] + buf[51];
    data[52] = buf[36] + buf[52];
    data[53] = buf[37] + buf[53];
    data[54] = buf[38] + buf[54];
    data[55] = buf[39] + buf[55];
    data[56] = buf[40] + buf[56];
    data[57] = buf[41] + buf[57];
    data[58] = buf[42] + buf[58];
    data[59] = buf[43] + buf[59];
    data[60] = buf[44] + buf[60];
    data[61] = buf[45] + buf[61];
    data[62] = buf[46] + buf[62];
    data[63] = buf[47] + buf[63];

    buf[0] = data[0] - data[8];
    buf[1] = data[1] - data[9];
    buf[2] = data[2] - data[10];
    buf[3] = data[3] - data[11];
    buf[4] = data[4] - data[12];
    buf[5] = data[5] - data[13];
    buf[6] = data[6] - data[14];
    buf[7] = data[7] - data[15];
    buf[16] = data[16] - data[24];
    buf[17] = data[17] - data[25];
    buf[18] = data[18] - data[26];
    buf[19] = data[19] - data[27];
    buf[20] = data[20] - data[28];
    buf[21] = data[21] - data[29];
    buf[22] = data[22] - data[30];
    buf[23] = data[23] - data[31];
    buf[32] = data[32] - data[40];
    buf[33] = data[33] - data[41];
    buf[34] = data[34] - data[42];
    buf[35] = data[35] - data[43];
    buf[36] = data[36] - data[44];
    buf[37] = data[37] - data[45];
    buf[38] = data[38] - data[46];
    buf[39] = data[39] - data[47];
    buf[48] = data[48] - data[56];
    buf[49] = data[49] - data[57];
    buf[50] = data[50] - data[58];
    buf[51] = data[51] - data[59];
    buf[52] = data[52] - data[60];
    buf[53] = data[53] - data[61];
    buf[54] = data[54] - data[62];
    buf[55] = data[55] - data[63];
    buf[8] = data[0] + data[8];
    buf[9] = data[1] + data[9];
    buf[10] = data[2] + data[10];
    buf[11] = data[3] + data[11];
    buf[12] = data[4] + data[12];
    buf[13] = data[5] + data[13];
    buf[14] = data[6] + data[14];
    buf[15] = data[7] + data[15];
    buf[24] = data[16] + data[24];
    buf[25] = data[17] + data[25];
    buf[26] = data[18] + data[26];
    buf[27] = data[19] + data[27];
    buf[28] = data[20] + data[28];
    buf[29] = data[21] + data[29];
    buf[30] = data[22] + data[30];
    buf[31] = data[23] + data[31];
    buf[40] = data[32] + data[40];
    buf[41] = data[33] + data[41];
    buf[42] = data[34] + data[42];
    buf[43] = data[35] + data[43];
    buf[44] = data[36] + data[44];
    buf[45] = data[37] + data[45];
    buf[46] = data[38] + data[46];
    buf[47] = data[39] + data[47];
    buf[56] = data[48] + data[56];
    buf[57] = data[49] + data[57];
    buf[58] = data[50] + data[58];
    buf[59] = data[51] + data[59];
    buf[60] = data[52] + data[60];
    buf[61] = data[53] + data[61];
    buf[62] = data[54] + data[62];
    buf[63] = data[55] + data[63];

    data[0] = buf[0] - buf[4];
    data[1] = buf[1] - buf[5];
    data[2] = buf[2] - buf[6];
    data[3] = buf[3] - buf[7];
    data[8] = buf[8] - buf[12];
    data[9] = buf[9] - buf[13];
    data[10] = buf[10] - buf[14];
    data[11] = buf[11] - buf[15];
    data[16] = buf[16] - buf[20];
    data[17] = buf[17] - buf[21];
    data[18] = buf[18] - buf[22];
    data[19] = buf[19] - buf[23];
    data[24] = buf[24] - buf[28];
    data[25] = buf[25] - buf[29];
    data[26] = buf[26] - buf[30];
    data[27] = buf[27] - buf[31];
    data[32] = buf[32] - buf[36];
    data[33] = buf[33] - buf[37];
    data[34] = buf[34] - buf[38];
    data[35] = buf[35] - buf[39];
    data[40] = buf[40] - buf[44];
    data[41] = buf[41] - buf[45];
    data[42] = buf[42] - buf[46];
    data[43] = buf[43] - buf[47];
    data[48] = buf[48] - buf[52];
    data[49] = buf[49] - buf[53];
    data[50] = buf[50] - buf[54];
    data[51] = buf[51] - buf[55];
    data[56] = buf[56] - buf[60];
    data[57] = buf[57] - buf[61];
    data[58] = buf[58] - buf[62];
    data[59] = buf[59] - buf[63];
    data[4] = buf[0] + buf[4];
    data[5] = buf[1] + buf[5];
    data[6] = buf[2] + buf[6];
    data[7] = buf[3] + buf[7];
    data[12] = buf[8] + buf[12];
    data[13] = buf[9] + buf[13];
    data[14] = buf[10] + buf[14];
    data[15] = buf[11] + buf[15];
    data[20] = buf[16] + buf[20];
    data[21] = buf[17] + buf[21];
    data[22] = buf[18] + buf[22];
    data[23] = buf[19] + buf[23];
    data[28] = buf[24] + buf[28];
    data[29] = buf[25] + buf[29];
    data[30] = buf[26] + buf[30];
    data[31] = buf[27] + buf[31];
    data[36] = buf[32] + buf[36];
    data[37] = buf[33] + buf[37];
    data[38] = buf[34] + buf[38];
    data[39] = buf[35] + buf[39];
    data[44] = buf[40] + buf[44];
    data[45] = buf[41] + buf[45];
    data[46] = buf[42] + buf[46];
    data[47] = buf[43] + buf[47];
    data[52] = buf[48] + buf[52];
    data[53] = buf[49] + buf[53];
    data[54] = buf[50] + buf[54];
    data[55] = buf[51] + buf[55];
    data[60] = buf[56] + buf[60];
    data[61] = buf[57] + buf[61];
    data[62] = buf[58] + buf[62];
    data[63] = buf[59] + buf[63];

    buf[0] = data[0] - data[2];
    buf[1] = data[1] - data[3];
    buf[4] = data[4] - data[6];
    buf[5] = data[5] - data[7];
    buf[8] = data[8] - data[10];
    buf[9] = data[9] - data[11];
    buf[12] = data[12] - data[14];
    buf[13] = data[13] - data[15];
    buf[16] = data[16] - data[18];
    buf[17] = data[17] - data[19];
    buf[20] = data[20] - data[22];
    buf[21] = data[21] - data[23];
    buf[24] = data[24] - data[26];
    buf[25] = data[25] - data[27];
    buf[28] = data[28] - data[30];
    buf[29] = data[29] - data[31];
    buf[32] = data[32] - data[34];
    buf[33] = data[33] - data[35];
    buf[36] = data[36] - data[38];
    buf[37] = data[37] - data[39];
    buf[40] = data[40] - data[42];
    buf[41] = data[41] - data[43];
    buf[44] = data[44] - data[46];
    buf[45] = data[45] - data[47];
    buf[48] = data[48] - data[50];
    buf[49] = data[49] - data[51];
    buf[52] = data[52] - data[54];
    buf[53] = data[53] - data[55];
    buf[56] = data[56] - data[58];
    buf[57] = data[57] - data[59];
    buf[60] = data[60] - data[62];
    buf[61] = data[61] - data[63];
    buf[2] = data[0] + data[2];
    buf[3] = data[1] + data[3];
    buf[6] = data[4] + data[6];
    buf[7] = data[5] + data[7];
    buf[10] = data[8] + data[10];
    buf[11] = data[9] + data[11];
    buf[14] = data[12] + data[14];
    buf[15] = data[13] + data[15];
    buf[18] = data[16] + data[18];
    buf[19] = data[17] + data[19];
    buf[22] = data[20] + data[22];
    buf[23] = data[21] + data[23];
    buf[26] = data[24] + data[26];
    buf[27] = data[25] + data[27];
    buf[30] = data[28] + data[30];
    buf[31] = data[29] + data[31];
    buf[34] = data[32] + data[34];
    buf[35] = data[33] + data[35];
    buf[38] = data[36] + data[38];
    buf[39] = data[37] + data[39];
    buf[42] = data[40] + data[42];
    buf[43] = data[41] + data[43];
    buf[46] = data[44] + data[46];
    buf[47] = data[45] + data[47];
    buf[50] = data[48] + data[50];
    buf[51] = data[49] + data[51];
    buf[54] = data[52] + data[54];
    buf[55] = data[53] + data[55];
    buf[58] = data[56] + data[58];
    buf[59] = data[57] + data[59];
    buf[62] = data[60] + data[62];
    buf[63] = data[61] + data[63];

    data[0] = buf[0] - buf[1];
    data[2] = buf[2] - buf[3];
    data[4] = buf[4] - buf[5];
    data[6] = buf[6] - buf[7];
    data[8] = buf[8] - buf[9];
    data[10] = buf[10] - buf[11];
    data[12] = buf[12] - buf[13];
    data[14] = buf[14] - buf[15];
    data[16] = buf[16] - buf[17];
    data[18] = buf[18] - buf[19];
    data[20] = buf[20] - buf[21];
    data[22] = buf[22] - buf[23];
    data[24] = buf[24] - buf[25];
    data[26] = buf[26] - buf[27];
    data[28] = buf[28] - buf[29];
    data[30] = buf[30] - buf[31];
    data[32] = buf[32] - buf[33];
    data[34] = buf[34] - buf[35];
    data[36] = buf[36] - buf[37];
    data[38] = buf[38] - buf[39];
    data[40] = buf[40] - buf[41];
    data[42] = buf[42] - buf[43];
    data[44] = buf[44] - buf[45];
    data[46] = buf[46] - buf[47];
    data[48] = buf[48] - buf[49];
    data[50] = buf[50] - buf[51];
    data[52] = buf[52] - buf[53];
    data[54] = buf[54] - buf[55];
    data[56] = buf[56] - buf[57];
    data[58] = buf[58] - buf[59];
    data[60] = buf[60] - buf[61];
    data[62] = buf[62] - buf[63];
    data[1] = buf[0] + buf[1];
    data[3] = buf[2] + buf[3];
    data[5] = buf[4] + buf[5];
    data[7] = buf[6] + buf[7];
    data[9] = buf[8] + buf[9];
    data[11] = buf[10] + buf[11];
    data[13] = buf[12] + buf[13];
    data[15] = buf[14] + buf[15];
    data[17] = buf[16] + buf[17];
    data[19] = buf[18] + buf[19];
    data[21] = buf[20] + buf[21];
    data[23] = buf[22] + buf[23];
    data[25] = buf[24] + buf[25];
    data[27] = buf[26] + buf[27];
    data[29] = buf[28] + buf[29];
    data[31] = buf[30] + buf[31];
    data[33] = buf[32] + buf[33];
    data[35] = buf[34] + buf[35];
    data[37] = buf[36] + buf[37];
    data[39] = buf[38] + buf[39];
    data[41] = buf[40] + buf[41];
    data[43] = buf[42] + buf[43];
    data[45] = buf[44] + buf[45];
    data[47] = buf[46] + buf[47];
    data[49] = buf[48] + buf[49];
    data[51] = buf[50] + buf[51];
    data[53] = buf[52] + buf[53];
    data[55] = buf[54] + buf[55];
    data[57] = buf[56] + buf[57];
    data[59] = buf[58] + buf[59];
    data[61] = buf[60] + buf[61];
    data[63] = buf[62] + buf[63];
}
